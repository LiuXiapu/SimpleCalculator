这周首先实现了大体框架：完成了计算器界面方面的设计，设计了主界面以及两个副界面（科学计算器界面以
及游戏经验值计算器界面）。实现按键事件监听，在科学计算器界面通过按钮advance调出其他计算符号按钮
界面。借鉴了开源代码中的计算器界面，并自己设计，重新安排，加入自己的功能。
难点：对于界面设计时的比例问题，参数大小，
接下来实现计算功能：首先是科学计算器方面，界面中上方为输入，下方为计算结果，实时对输入的算式进行
计算并显示，在按下等号后将计算结果移至上方。
难点：实现算式输入错误时的报错，并适应各种特殊输入（例如有时需要补上括号，乘号等），安排计算优
先度并达成完美计算。

以上为孙吴军周报。


这周做了一个基于android的计算器。已经完成。

完成了两个功能，为科学计算器与游戏经验值计算器。

我们组认为把其他奇怪的计算器与科学计算器结合起来非常不伦不类，所以重点实现了科学计算器，包括界面，动画，与解析输入字符串得出结果。

游戏计算器为本组同学所玩的游戏的一个插件的一个activity，由我对照界面，复原了这个activity。

遇到的困难：

首先是我已经一年没有做过android app了，android studio和android sdk和gradle都进行了更新，另一方面也是由于手生，所以花了很久才找到手感。

另外android studio与gradle更新到3.0版本之后，默认的jre为java1.8，但是由于google与gradle方面的掷杖，导致很多真正的java1.8内容并不支持，例如
lambda表达式（虽然不是java8特有），所以很多的开源组件无法使用。而且从gradle2移植到gradle3也需要很多的改动。这点在下面会详细说明。

本app制作时间为3天，其中有整整2天时间都在处理android studio3.0与开源的科学计算组建之间的兼容问题。本人在github与stackoverflow还有quora上找了很久，
并没有找到任何能实际解决本人遇得到的兼容问题的答案。所以最后被迫放弃使用开源组件，自己手动实现输入字符串的tokenized与syntax最后进行计算。

也正是因为如此，所以把 原本许多功能砍掉，我们组认为，单纯依靠这段字符串的解析，就能拿到高分。

另外关于界面，我们实现了初入字符串过长时的字号变化功能，ResizingTextView(好像是这个名字)，还有清空与错误时的动画（使用support.v7包的功能）。

下面详细介绍我们从0实现的计算器的tokenized与syntax与calculate功能

resolveFromString
tryCalculate
calculateInner
getFunctionResult
getConstantValue
addParen
syntaxElements
addZeroAndMulOp
fixAError
getElementsFromExpression
getSlicesWithTokens

以上是Resolver类的主要实现功能

大致流程为，首先通过关键字（函数名），操作符，常数（E,PI）把输入的字符串分解成一个一个的基本字符串
如 +sin(1.1.1.E 分解为 +  sin  (  1.1.1.  E

修改分解错误，即 tan 与 atan都为关键字，所以atan 会分解为a 与 tan， 这是个错误，需要修复。

然后进行插入操作符与0的操作。
例如 -Esin(3*5E5 
经过插入0与运算符后，成为
0-E*sin(3*5*E*5
保证数与常数，函数名之间的缺失乘号会被补上，而且正负号前会补0，使操作符左右都是能计算的元素（常数，函数名，数）

接着检查输入语法是否错误
错误条件为 括号不匹配，连续运算符，数字格式错误

经过检查语法错误后，进行自动补充右括号的操作 如
sin((1
修正后变为
sin((1))

最后是尝试计算
这个方法，
首先递归处理括号，保证输入串中的括号都被计算出来并被替换掉
然后替换常数为具体的数字
再对函数进行计算，
最后再按照运算优先级，就行普通的计算。

如果成功就会返回结果（包括Infinity Nan）等等
这是一个相对完美地计算器

我们精心设计了这一部分，并考虑了所有能想到的细节。

好了，其他的就懒得说了。

刘夏璞 2018/3/18 23:59